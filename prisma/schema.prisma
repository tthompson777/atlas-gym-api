generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model Aluno {
  id                 Int              @id @default(autoincrement())
  nome               String
  sexo               String
  nascimento         DateTime
  telefone           String?
  email              String?          @unique
  cpf                String           @unique
  rg                 String?
  responsavel        String?
  gympassId          String?
  autorizaMarketing  Boolean          @default(false)
  origem             String?
  nivel              String?
  cep                String?
  rua                String?
  numero             String?
  complemento        String?
  bairro             String?
  cidade             String?
  estado             String?
  pais               String?
  status             String           @default("Pendente")
  criadoEm           DateTime         @default(now())
  fotoBase64         String?          @db.Text
  descriptor         Json?
  senha              String?
  empresaId          Int
  
  // Dados do Contrato
  unidade            String?
  dataInicio         DateTime?
  parcelas           Int?
  parcelasManutencao Int?
  parcelasAdesao     Int?
  plano              String?
  codigoPromocional  String?
  vendedor           String?
  formaPagamento     String?

  empresa            Empresa          @relation(fields: [empresaId], references: [id])
  fichas             FichaExercicio?
  entradas           RegistroAcesso[]
  Transacao          Transacao[]

  @@index([empresaId], map: "Aluno_empresaId_fkey")
}

model RegistroAcesso {
  id          Int       @id @default(autoincrement())
  alunoId     Int
  dataEntrada DateTime
  dataSaida   DateTime?
  aluno       Aluno     @relation(fields: [alunoId], references: [id])

  @@index([alunoId], map: "RegistroAcesso_alunoId_fkey")
}

model Transacao {
  id              Int      @id @default(autoincrement())
  tipo            String
  categoria       String
  valor           Float
  descricao       String?
  dataHora        DateTime @default(now())
  alunoId         Int?
  paymentLink     String?
  statusPagamento String?
  empresaId       Int
  aluno           Aluno?   @relation(fields: [alunoId], references: [id])
  empresa         Empresa  @relation(fields: [empresaId], references: [id])

  @@index([alunoId], map: "Transacao_alunoId_fkey")
  @@index([empresaId], map: "Transacao_empresaId_fkey")
}

model FichaExercicio {
  id          Int         @id @default(autoincrement())
  alunoId     Int         @unique
  dataCriacao DateTime    @default(now())
  exercicios  Exercicio[]
  aluno       Aluno       @relation(fields: [alunoId], references: [id])
}

model Exercicio {
  id         Int            @id @default(autoincrement())
  grupo      String
  nome       String
  series     Int
  repeticoes Int
  treino     String         @default("A") // "A", "B", "C"
  fichaId    Int
  ficha      FichaExercicio @relation(fields: [fichaId], references: [id])

  @@index([fichaId], map: "Exercicio_fichaId_fkey")
}

model Empresa {
  id            Int         @id @default(autoincrement())
  nome          String
  email         String      @unique
  mpAccessToken String?     @db.Text
  mpPublicKey   String?     @db.Text
  criadoEm      DateTime    @default(now())
  alunos        Aluno[]
  transacoes    Transacao[]
  Usuario       Usuario[]
}

model Superadmin {
  id    Int    @id @default(autoincrement())
  email String @unique
  senha String
}

model Usuario {
  id        Int      @id @default(autoincrement())
  nome      String
  email     String   @unique
  senhaHash String
  role      Int      @default(0)
  empresaId Int
  criadoEm  DateTime @default(now())
  empresa   Empresa  @relation(fields: [empresaId], references: [id])

  @@index([empresaId], map: "Usuario_empresaId_fkey")
}
